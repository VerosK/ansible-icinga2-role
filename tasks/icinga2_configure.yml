---
- name: Copy Main Icinga2 Configuration
  template:
    src: icinga2.conf.j2
    dest: '{{ icinga2_main_conf }}'
    backup: yes
    owner: root
    group: root
    mode: 0644
  notify: 
   - restart icinga2

- name: Copy Check Commands Configuration
  template:
    src: icinga2_check_commands.j2
    dest: '{{ icinga2_conf_d }}/check_commands.conf'
    backup: yes
    owner: root
    group: root
    mode: 0644
  notify: 
   - restart icinga2

- name: Create icinga ido pg_user
  postgresql_user:
    name: '{{ icinga2_ido_pg_user }}'
    password: '{{ icinga2_ido_pg_password }}'
    role_attr_flags: NOCREATEDB,NOSUPERUSER
  become_user: postgres
  become: true
  when: icinga2_ido_with_postgres

- name: "Update icinga2 features"
  icinga2_features:
    features: '{{ __icinga2_features|combine(icinga2_features) }}'
